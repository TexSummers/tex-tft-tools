<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crystal Gambit Tool</title>
  <style>
    body { 
      background:#121212; 
      color:#e6edf3; 
      font-family:'Segoe UI',sans-serif; 
      padding:30px;
    }
    h1 {
      color:#58a6ff;
      text-align:center;
      margin-bottom:10px;
    }
    label {
      display:block;
      margin-top:10px;
      font-weight:bold;
    }
    input[type="number"] {
      width:80px;
      padding:5px;
      font-size:1rem;
      margin-left:10px;
    }
    #calcBtn {
      padding:6px 12px;
      margin-left:10px;
      background: linear-gradient(90deg, #58a6ff, #9b59b6);
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      transition:0.3s;
    }
    #calcBtn:hover { opacity:0.85; }
    .round-buttons {
      margin-top:15px;
      text-align:center;
    }
    .round-buttons button {
      margin:5px;
      padding:8px 14px;
      border-radius:12px;
      border:none;
      cursor:pointer;
      background:#161b22;
      color:#e6edf3;
      font-weight:bold;
      transition:0.3s;
    }
    .round-buttons button:hover { background:#1f2a36; }
    .round-buttons button.active { background:#58a6ff; color:#121212; }

    .dd-block {
      display:inline-block;
      vertical-align:top;
      background:#161b22;
      border:1px solid #30363d;
      border-radius:12px;
      padding:15px;
      margin:10px;
      width:220px;
      text-align:left;
      box-shadow:0 4px 10px rgba(0,0,0,0.4);
    }
    .dd-block h3 { margin:0 0 5px 0; color:#58a6ff; }
    .dd-block p, .dd-block .small-text { font-size:0.85rem; color:#8b949e; margin:2px 0; }
    .error-note { color:#ff5555; font-weight:bold; text-align:center; margin-top:10px; }

    /* Top navigation button */
    .nav-button {
      text-align:right;
      margin-bottom:15px;
    }
    .nav-button a {
      background: linear-gradient(90deg, #58a6ff, #9b59b6);
      color:#fff;
      padding:8px 14px;
      border-radius:8px;
      text-decoration:none;
      font-weight:bold;
      font-size:0.9rem;
      transition:0.3s;
    }
    .nav-button a:hover { opacity:0.85; }
  </style>
</head>
<body>
  <div class="nav-button">
    <a href="ornn_tool.html">Go to Ornn Artifact Tool</a>
  </div>

  <h1>Crystal Gambit Tool</h1>

  <label>Current Stacks: <input type="number" id="currentStacks" min="0" value="0"></label>
  <label>Avg. Kills per Round: <input type="number" id="avgKills" min="0" value="0"></label>
  <button id="calcBtn">Calculate</button>

  <div class="round-buttons">
    <p>Doubling Down on:</p>
    <button>2-1</button>
    <button>2-2</button>
    <button>2-3</button>
    <button>2-5</button>
    <button>2-6</button>
    <button>2-7</button>
    <button>3-2</button>
    <button>3-3</button>
    <button>3-5</button>
    <button>3-6</button>
    <button>3-7</button>
    <button>4-2</button>
    <button>4-3</button>
    <button>4-5</button>
    <button>4-6</button>
    <button>4-7</button>
  </div>

  <div id="output" style="margin-top:20px;"></div>

  <script>
    const output = document.getElementById("output");

    const stageData = {
      2:{loss:26, kill:4},
      3:{loss:32, kill:5},
      4:{loss:48, kill:7},
      5:{loss:48, kill:7},
      6:{loss:48, kill:7},
      7:{loss:48, kill:7}
    };

    const breakpoints = [30,65,100,135,170,210,250,300,350,400,500,600,700,800,900,1000,1100,1200];

    let activeStage = null;

    document.querySelectorAll(".round-buttons button").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        document.querySelectorAll(".round-buttons button").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        activeStage = btn.textContent;
        calculate(activeStage);
      });
    });

    function getStage(roundStr){ return parseInt(roundStr.split("-")[0]); }
    function getNextRound(stage, round){
      let seq = [1,2,3,5,6,7];
      let idx = seq.indexOf(round);
      if(idx===-1) idx=0;
      idx++;
      if(idx>=seq.length){ stage++; idx=0; }
      return [stage, seq[idx]];
    }
    function getBreakpoint(stacks){
      let bp=0;
      for(let i of breakpoints){
        if(stacks>=i) bp=i;
        else break;
      }
      return bp;
    }

    function simulateDoubleDown(stage, round, stacks, avgKills){
      let results=[];
      let s=stacks;
      let r=round;
      let stg=stage;
      let count=0;
      while(count<3){
        if(stg>4 && stg>7) break; // optional safety
        s += stageData[stg].loss + (stageData[stg].kill * avgKills);
        results.push({stage:stg, round:r, stacks:s});
        [stg,r]=getNextRound(stg,r);
        count++;
      }
      return results;
    }

    function calculate(round){
      output.innerHTML="";
      const stacksVal = parseInt(document.getElementById("currentStacks").value);
      const avgKills = parseInt(document.getElementById("avgKills").value);

      if(!stacksVal){ output.innerHTML='<div class="error-note">Enter some stacks first, FOOL</div>'; return; }
      if(!round){ output.innerHTML='<div class="error-note">Choose a stage first, FOOL</div>'; return; }

      let stage = getStage(round);
      let roundNum = parseInt(round.split("-")[1]);

      let firstDD = simulateDoubleDown(stage, roundNum, stacksVal, avgKills);
      let firstBP = getBreakpoint(firstDD[firstDD.length-1].stacks);

      const createBlock = (title, currentStacks, ddArray, bp, noteText="")=>{
        let block = document.createElement("div");
        block.classList.add("dd-block");
        let totalStacks = ddArray[ddArray.length-1].stacks;
        let stacksToNext= breakpoints.find(b=>b>totalStacks) - totalStacks;
        let nextBP= breakpoints.find(b=>b>totalStacks) || totalStacks;
        block.innerHTML=`
          <h3>${title}</h3>
          <p class="small-text">(Current stacks: ${currentStacks})</p>
          ${ddArray.map(d=>`<p>${d.stage}-${d.round}: ${d.stacks}</p>`).join('')}
          <p><b>Total: ${totalStacks} stacks</b></p>
          <p class="small-text">(${stacksToNext} stacks away from ${nextBP} cashout)</p>
          <p>Expected Cashout: <b>${bp}</b> <b>on</b> <b>${ddArray[ddArray.length-1].stage}-${ddArray[ddArray.length-1].round}</b></p>
          ${noteText}
        `;
        return block;
      };

      output.appendChild(createBlock("Double Down", stacksVal, firstDD, firstBP));

    }

    document.getElementById("calcBtn").addEventListener("click", ()=>{
      const activeBtn = document.querySelector(".round-buttons button.active");
      calculate(activeBtn?activeBtn.textContent:null);
    });
  </script>
</body>
</html>
